<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rego-cpp: &lt;tt&gt;rego-cpp&lt;/tt&gt;</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="regocpp-logo-48.png"/></td>
  <td id="projectalign">
   <div id="projectname">rego-cpp<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">A C++ implementation of the Rego language and runtime</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title"><code>rego-cpp</code> </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a></p>
<p>This project is an effort to create a C++ interpreter for the OPA policy language, <a href="https://www.openpolicyagent.org/docs/latest/policy-language/">Rego</a>. Our goal is to build both a standalone executable and a library such that programmers who are working in C++ can interpret Rego programs natively. To achieve this we are building our interpreter on top of the experimental term rewriter <a href="https://github.com/microsoft/trieste">Trieste</a>.</p>
<blockquote class="doxtable">
<p>&zwj;<b>Warning</b> While this project has progressed to the point that we support full Rego language (see <a class="el" href="#language-support">Language Support</a> below) we do not support all built-ins. That said, we have verified compliance with the OPA Rego test suite. Even so, it should still be considered experimental software and used with discretion. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md1"></a>
Getting Started</h1>
<p>Start by installing <a href="https://cmake.org/">CMake</a> in the way appropriate for your environment.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Linux</h2>
<p>Create a build directory and initialize the cmake project: </p><pre class="fragment">mkdir build
cd build
cmake .. --preset release-clang
</pre><p>You can then build and run the tests using: </p><pre class="fragment">ninja install
ctest
</pre><h2><a class="anchor" id="autotoc_md3"></a>
Windows</h2>
<p>Create a build directory and initialize the cmake project: </p><pre class="fragment">mkdir build
cd build
cmake .. --preset release
</pre><p>You can then build and run the tests using: </p><pre class="fragment">cmake --build . --config Release --target INSTALL
ctest -C Release
</pre><h2><a class="anchor" id="autotoc_md4"></a>
Using the <code>rego</code> CLI</h2>
<p>The interpreter tool will be located at <code>build/dist/bin/rego</code>. Here are some example commands using the provided example files and run from the suggested <code>dist</code> install directory: </p><pre class="fragment">./bin/rego -d examples/scalars.rego -q data.scalars.greeting
{"expressions":["Hello"]}

./bin/rego -d examples/objects.rego -q data.objects.sites[1].name
{"expressions":["smoke1"]}

./bin/rego -d examples/data0.json examples/data1.json examples/objects.rego -i examples/input0.json  -q "[data.one, input.b, data.objects.sites[1]]"
{"expressions":[[{"bar":"Foo", "baz":5, "be":true, "bop":23.4}, "20", {"name":"smoke1"}]]}

./bin/rego -q "5 + (2 - 4 * 0.25) * -3 + 7.4"
{"bindings":{"x":5, "y":9.4}}

./bin/rego -d examples/bodies.rego -i examples/input1.json -q data.bodies.e
{"expressions":[{"one":15, "two":15}]}
</pre><p>You can run the test driver from the same directory: </p><pre class="fragment">./bin/rego_test tests/regocpp.yaml
</pre><h2><a class="anchor" id="autotoc_md5"></a>
Using the <code>rego</code> Library</h2>
<p>See the <a class="el" href="md_examples_2README.html">examples</a> directory for examples of how to use the library from different langauages.</p>
<h1><a class="anchor" id="language-support"></a>
Language Support</h1>
<p>We support v1.8.0 of Rego as defined by OPA, with the following grammar:</p>
<div class="fragment"><div class="line">module          = package { import } policy</div>
<div class="line">package         = &quot;package&quot; ref</div>
<div class="line">import          = &quot;import&quot; ref [ &quot;as&quot; var ]</div>
<div class="line">policy          = { rule }</div>
<div class="line">rule            = [ &quot;default&quot; ] rule-head { rule-body }</div>
<div class="line">rule-head       = ( ref | var ) ( rule-head-set | rule-head-obj | rule-head-func | rule-head-comp )</div>
<div class="line">rule-head-comp  = [ assign-operator term ] [ &quot;if&quot; ]</div>
<div class="line">rule-head-obj   = &quot;[&quot; term &quot;]&quot; [ assign-operator term ] [ &quot;if&quot; ]</div>
<div class="line">rule-head-func  = &quot;(&quot; rule-args &quot;)&quot; [ assign-operator term ] [ &quot;if&quot; ]</div>
<div class="line">rule-head-set   = &quot;contains&quot; term [ &quot;if&quot; ] | &quot;[&quot; term &quot;]&quot;</div>
<div class="line">rule-args       = term { &quot;,&quot; term }</div>
<div class="line">rule-body       = [ &quot;else&quot; [ assign-operator term ] [ &quot;if&quot; ] ] ( &quot;{&quot; query &quot;}&quot; ) | literal</div>
<div class="line">query           = literal { ( &quot;;&quot; | ( [CR] LF ) ) literal }</div>
<div class="line">literal         = ( some-decl | expr | &quot;not&quot; expr ) { with-modifier }</div>
<div class="line">with-modifier   = &quot;with&quot; term &quot;as&quot; term</div>
<div class="line">some-decl       = &quot;some&quot; term { &quot;,&quot; term } { &quot;in&quot; expr }</div>
<div class="line">expr            = term | expr-call | expr-infix | expr-every | expr-parens | unary-expr</div>
<div class="line">expr-call       = var [ &quot;.&quot; var ] &quot;(&quot; [ expr { &quot;,&quot; expr } ] &quot;)&quot;</div>
<div class="line">expr-infix      = expr infix-operator expr</div>
<div class="line">expr-every      = &quot;every&quot; var { &quot;,&quot; var } &quot;in&quot; ( term | expr-call | expr-infix ) &quot;{&quot; query &quot;}&quot;</div>
<div class="line">expr-parens     = &quot;(&quot; expr &quot;)&quot;</div>
<div class="line">unary-expr      = &quot;-&quot; expr</div>
<div class="line">membership      = term [ &quot;,&quot; term ] &quot;in&quot; term</div>
<div class="line">term            = ref | var | scalar | array | object | set | membership | array-compr | object-compr | set-compr</div>
<div class="line">array-compr     = &quot;[&quot; term &quot;|&quot; query &quot;]&quot;</div>
<div class="line">set-compr       = &quot;{&quot; term &quot;|&quot; query &quot;}&quot;</div>
<div class="line">object-compr    = &quot;{&quot; object-item &quot;|&quot; query &quot;}&quot;</div>
<div class="line">infix-operator  = assign-operator | bool-operator | arith-operator | bin-operator</div>
<div class="line">bool-operator   = &quot;==&quot; | &quot;!=&quot; | &quot;&lt;&quot; | &quot;&gt;&quot; | &quot;&gt;=&quot; | &quot;&lt;=&quot;</div>
<div class="line">arith-operator  = &quot;+&quot; | &quot;-&quot; | &quot;*&quot; | &quot;/&quot; | &quot;%&quot;</div>
<div class="line">bin-operator    = &quot;&amp;&quot; | &quot;|&quot;</div>
<div class="line">assign-operator = &quot;:=&quot; | &quot;=&quot;</div>
<div class="line">ref             = ( var | array | object | set | array-compr | object-compr | set-compr | expr-call ) { ref-arg }</div>
<div class="line">ref-arg         = ref-arg-dot | ref-arg-brack</div>
<div class="line">ref-arg-brack   = &quot;[&quot; ( scalar | var | array | object | set | &quot;_&quot; ) &quot;]&quot;</div>
<div class="line">ref-arg-dot     = &quot;.&quot; var</div>
<div class="line">var             = ( ALPHA | &quot;_&quot; ) { ALPHA | DIGIT | &quot;_&quot; }</div>
<div class="line">scalar          = string | NUMBER | TRUE | FALSE | NULL</div>
<div class="line">string          = STRING | raw-string</div>
<div class="line">raw-string      = &quot;`&quot; { CHAR-&quot;`&quot; } &quot;`&quot;</div>
<div class="line">array           = &quot;[&quot; term { &quot;,&quot; term } &quot;]&quot;</div>
<div class="line">object          = &quot;{&quot; object-item { &quot;,&quot; object-item } &quot;}&quot;</div>
<div class="line">object-item     = ( scalar | ref | var ) &quot;:&quot; term</div>
<div class="line">set             = empty-set | non-empty-set</div>
<div class="line">non-empty-set   = &quot;{&quot; term { &quot;,&quot; term } &quot;}&quot;</div>
<div class="line">empty-set       = &quot;set(&quot; &quot;)&quot;</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>This grammar corresponds to Rego with <code>rego.v1</code> enabled (See <a href="https://www.openpolicyagent.org/docs/latest/opa-1">OPA v1.0</a> for more info).</dd></dl>
<p>Definitions: </p><div class="fragment"><div class="line">[]     optional (zero or one instances)</div>
<div class="line">{}     repetition (zero or more instances)</div>
<div class="line">|      alternation (one of the instances)</div>
<div class="line">()     grouping (order of expansion)</div>
<div class="line">STRING JSON string</div>
<div class="line">NUMBER JSON number</div>
<div class="line">TRUE   JSON true</div>
<div class="line">FALSE  JSON false</div>
<div class="line">NULL   JSON null</div>
<div class="line">CHAR   Unicode character</div>
<div class="line">ALPHA  ASCII characters A-Z and a-z</div>
<div class="line">DIGIT  ASCII characters 0-9</div>
<div class="line">CR     Carriage Return</div>
<div class="line">LF     Line Feed</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
Builtins</h2>
<p>At the moment support the following builtins are available:</p>
<ul>
<li><code>aggregates</code></li>
<li><code>arrays</code></li>
<li><code>bits</code></li>
<li><code>casts</code></li>
<li><code>encoding</code></li>
<li><code>graphs</code></li>
<li><code>numbers</code></li>
<li><code>objects</code></li>
<li><code>regex</code></li>
<li><code>semver</code></li>
<li><code>sets</code></li>
<li><code>strings</code></li>
<li><code>time</code></li>
<li><code>types</code></li>
<li><code>units</code></li>
<li><code>uuid</code></li>
<li>miscellaneous<ul>
<li><code>opa.runtime</code></li>
<li><code>print</code></li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md7"></a>
Compatibility with the OPA Rego Go implementation</h2>
<p>Our goal is to achieve and maintain full compatibility with the reference Go implementation. We have developed a test driver which runs the same tests and validates that we produce the same outputs. At this stage we pass all the non-builtin specific test suites, which we clone from the <a href="https://github.com/open-policy-agent/opa/tree/main/test/cases/testdata">OPA repository</a>. To build with the OPA tests available for testing, use one of the following presets:</p><ul>
<li><code>release-clang-opa</code></li>
<li><code>release-opa</code></li>
</ul>
<p>At present, we are <b>NOT</b> passing the following test suites in full:</p><ul>
<li><code>crypto*</code></li>
<li><code>glob*</code></li>
<li><code>graphql</code></li>
<li><code>invalidkeyerror</code></li>
<li><code>json*</code> (except <code>jsonbuiltins</code>)</li>
<li><code>jwt*</code></li>
<li><code>net*</code></li>
<li><code>planner-ir</code></li>
<li><code>providers-aws</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md8"></a>
Contributing</h1>
<p>This project welcomes contributions and suggestions. Most contributions require you to agree to a Contributor License Agreement (CLA) declaring that you have the right to, and actually do, grant us the rights to use your contribution. For details, visit <a href="https://cla.opensource.microsoft.com">https://cla.opensource.microsoft.com</a>.</p>
<p>When you submit a pull request, a CLA bot will automatically determine whether you need to provide a CLA and decorate the PR appropriately (e.g., status check, comment). Simply follow the instructions provided by the bot. You will only need to do this once across all repos using our CLA.</p>
<p>This project has adopted the <a href="https://opensource.microsoft.com/codeofconduct/">Microsoft Open Source Code of Conduct</a>. For more information see the <a href="https://opensource.microsoft.com/codeofconduct/faq/">Code of Conduct FAQ</a> or contact <a href="#" onclick="location.href='mai'+'lto:'+'ope'+'nc'+'ode'+'@m'+'icr'+'os'+'oft'+'.c'+'om'; return false;">opencode@microsoft.com</a> with any additional questions or comments.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Trademarks</h1>
<p>This project may contain trademarks or logos for projects, products, or services. Authorized use of Microsoft trademarks or logos is subject to and must follow <a href="https://www.microsoft.com/en-us/legal/intellectualproperty/trademarks/usage/general">Microsoft's Trademark &amp; Brand Guidelines</a>. Use of Microsoft trademarks or logos in modified versions of this project must not cause confusion or imply Microsoft sponsorship. Any use of third-party trademarks or logos are subject to those third-party's policies. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
